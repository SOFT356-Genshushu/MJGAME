{"version":3,"sources":["Handler.js"],"names":["User","require","Majiang","Handler","logicCom","eventQueue","data","scrPos","getScreenPos","pos","showHead","playerId","headimgUrl","nickName","cardIndexs","i","cardIndex","cardUi","creatHandCardsUi","handCardsPos","x","y","handCardsUi","addChild","tIndex","selfHandCard","ui","bindCardEvt","handCards","zIndex","adjustSelfHandCard","cardIndex_s","type","turn","touchCard","cc","log","actionId","hitCard","showActionSelectUi","action","handledoAction","finished","raceScore","shareScore","handlehu","showFinalScore","posScores","posNames","g","module","exports","service","inPos","cb","instance","push","eventName","startCards","toHitCard","toWaitAction","doAction","hu"],"mappings":"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","file":"Handler.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\resources\\resources\\modules","sourcesContent":["var User = require('Users');\r\nvar Majiang = require('Chess').Majiang;\r\nclass Handler{\r\n    constructor(){\r\n        this.logicCom = null;//游戏组件\r\n        this.eventQueue = [];//消息队列\r\n    }\r\n    static instance(){\r\n        if(Handler.g==null)Handler.g = new Handler();\r\n        return Handler.g;\r\n    }\r\n\r\n    handleinPos(data){\r\n        var scrPos = this.logicCom.getScreenPos(User.pos,data.pos)\r\n        this.logicCom.showHead(data.playerId,scrPos,data.headimgUrl,data.nickName);\r\n    } \r\n    handlestartCards(data){\r\n        \r\n        var cardIndexs = data.cardIndexs;\r\n        for(var i=0;i<13;i++){\r\n            var cardIndex = cardIndexs[i];\r\n            var cardUi = this.logicCom.creatHandCardsUi(2,cardIndex);\r\n            var pos = this.logicCom.handCardsPos[2][i];\r\n            cardUi.x = pos.x;\r\n            cardUi.y=pos.y;\r\n            this.logicCom.handCardsUi.addChild(cardUi);\r\n            var tIndex = Majiang.tIndex(cardIndex);\r\n            this.logicCom.selfHandCard[tIndex][''+cardIndex]={ui:cardUi};\r\n            this.logicCom.bindCardEvt(cardIndex,cardUi);\r\n\r\n            var cardUi = this.logicCom.creatHandCardsUi(0,cardIndex);\r\n            var pos = this.logicCom.handCardsPos[0][i];\r\n            cardUi.x = pos.x;\r\n            cardUi.y=pos.y;\r\n            this.logicCom.handCardsUi.addChild(cardUi);\r\n\r\n            this.logicCom.handCards[0][i] = {ui:cardUi,cardIndex:cardIndex};\r\n\r\n            var cardUi = this.logicCom.creatHandCardsUi(1,cardIndex);\r\n            var pos = this.logicCom.handCardsPos[1][i];\r\n            cardUi.x = pos.x;\r\n            cardUi.y=pos.y;\r\n            this.logicCom.handCardsUi.addChild(cardUi);\r\n            this.logicCom.handCards[1][i] = {ui:cardUi,cardIndex:cardIndex};\r\n\r\n            var cardUi = this.logicCom.creatHandCardsUi(3,cardIndex);\r\n            var pos = this.logicCom.handCardsPos[3][i];\r\n            cardUi.x = pos.x;\r\n            cardUi.y=pos.y;\r\n            cardUi.zIndex = 14-i;\r\n            //this.logicCom.node.zIndex = i;\r\n            this.logicCom.handCardsUi.addChild(cardUi);\r\n            this.logicCom.handCards[3][i] = {ui:cardUi,cardIndex:cardIndex};\r\n        }\r\n        this.logicCom.adjustSelfHandCard();\r\n    }\r\n\r\n    handletouchCard(data){\r\n        var pos = data.pos;\r\n        var cardIndex_s = data.cardIndex_s;\r\n        var scrPos = this.logicCom.getScreenPos(User.pos,pos);\r\n        var type = User.pos ==pos?1:2;\r\n        this.logicCom.turn(scrPos);\r\n        this.logicCom.touchCard(scrPos,cardIndex_s,type);\r\n        cc.log('触发touch');\r\n    }\r\n    handletoHitCard(data){\r\n        var pos = data.pos;\r\n        var scrPos = this.logicCom.getScreenPos(User.pos,pos);\r\n        this.logicCom.turn(scrPos);\r\n        this.logicCom.actionId = data.actionId;\r\n    }\r\n    handlehitCard(data){\r\n        var pos = data.pos;\r\n        var cardIndex = data.cardIndex;\r\n        var scrPos = this.logicCom.getScreenPos(User.pos,pos);\r\n        var type = User.pos ==pos?1:2;\r\n        this.logicCom.hitCard(scrPos,cardIndex,type);\r\n    }\r\n    handletoWaitAction(data){\r\n        this.logicCom.actionId = data.actionId;\r\n        this.logicCom.showActionSelectUi(data.action);\r\n    }\r\n    handledoAction(data){\r\n        this.logicCom.handledoAction(data);\r\n    }\r\n    handlehu(data){\r\n        if(data.finished)this.logicCom.raceScore = data.shareScore\r\n        this.logicCom.handlehu(data);\r\n        cc.log('hu');\r\n    }\r\n    handleshareScore(data){//结算页面\r\n        this.logicCom.showFinalScore(data.posScores,data.posNames);\r\n    }\r\n}\r\nmodule.exports = Handler;\r\nHandler.g=null;\r\n\r\nHandler.service = {};\r\nHandler.service.inPos = function (data,cb) {\r\n    cc.log(\"收到服务器端信息：inPos\");\r\n    cc.log(data);\r\n    Handler.instance().eventQueue.push({eventName:'inPos',data:data});\r\n    //Handler.instance().handlerinPos(data);\r\n}\r\n\r\nHandler.service.startCards = function (data,cb) {\r\n    cc.log('收到开牌消息: %o',data);\r\n    Handler.instance().eventQueue.push({eventName:'startCards',data:data});\r\n    //Handler.instance().handlestartCards(data);\r\n}\r\n\r\nHandler.service.touchCard = function (data,cb) {\r\n    cc.log('收到摸牌消息: %o',data);\r\n    Handler.instance().eventQueue.push({eventName:'touchCard',data:data});\r\n    //Handler.instance().handlestartCards(data);\r\n}\r\n\r\nHandler.service.toHitCard = function (data,cb) {\r\n    cc.log('收到轮到谁打牌的消息: %o',data);\r\n    Handler.instance().eventQueue.push({eventName:'toHitCard',data:data});\r\n    //Handler.instance().handlestartCards(data);\r\n}\r\n\r\nHandler.service.hitCard = function (data,cb) {\r\n    cc.log('收到实际打下来牌的消息: %o',data);\r\n    Handler.instance().eventQueue.push({eventName:'hitCard',data:data});\r\n    //Handler.instance().handlestartCards(data);\r\n}\r\nHandler.service.toWaitAction = function (data,cb) {\r\n    cc.log('收到等待玩家操作消息: %o',data);\r\n    Handler.instance().eventQueue.push({eventName:'toWaitAction',data:data});\r\n    //Handler.instance().handlestartCards(data);\r\n}\r\nHandler.service.doAction = function (data,cb) {\r\n    cc.log('收到玩家选择动作消息: %o',data);\r\n    Handler.instance().eventQueue.push({eventName:'doAction',data:data});\r\n    //Handler.instance().handlestartCards(data);\r\n}\r\n\r\nHandler.service.hu = function (data,cb) {\r\n    cc.log('收到胡牌消息: %o',data);\r\n    Handler.instance().eventQueue.push({eventName:'hu',data:data});\r\n    //Handler.instance().handlestartCards(data);\r\n}\r\n\r\nHandler.service.shareScore = function (data,cb) {\r\n    cc.log('收到Share消息: %o',data);\r\n    Handler.instance().eventQueue.push({eventName:'shareScore',data:data});\r\n    //Handler.instance().handlestartCards(data);\r\n}"]}